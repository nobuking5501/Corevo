# AI Insight Design

## 概要

AIによる経営分析とインサイト生成の設計ドキュメント。

## インサイトの種類

### 1. Alert（注意報）

経営上の問題点やリスクを警告。

**例:**
- No-show率が高い（>10%）
- 売上が先週比で大幅減少（>20%）
- 特定スタッフの稼働率が低い（<50%）

### 2. Opportunity（機会）

売上向上や顧客満足度向上のチャンス。

**例:**
- 人気メニューの需要増加
- 新規顧客の増加トレンド
- 特定曜日の予約集中パターン

### 3. Shortage（不足分析）

リソースや顧客数の不足を指摘。

**例:**
- 平均顧客数が低い
- 特定時間帯の予約が埋まらない
- 既存顧客のリピート率低下

## 生成アルゴリズム

### 優先度スコア

1～10の整数。以下の要素で計算：

- **重要度**: 売上への影響度
- **緊急度**: 対処の必要性
- **実行可能性**: アクションの具体性

### 生成頻度

- 毎日03:45に`insightJob`で生成
- 30日以上古いインサイトは自動削除
- 同じ種類のインサイトが重複しないよう管理

## 実装方針

### フェーズ1（現在）

シンプルなルールベースでインサイト生成：

```typescript
if (avgNoshowRate > 0.1) {
  createInsight({
    type: "alert",
    title: "No-show率が高くなっています",
    description: `直近7日間の平均No-show率が${avgNoshowRate}%です。`,
    actionable: "前日リマインダーの強化をご検討ください。",
    priority: 9,
  });
}
```

### フェーズ2（将来）

Claude API を使った高度な分析：

- 複数メトリクスの相関分析
- 時系列パターン認識
- 自然言語での説明生成

## インサイトテンプレート

### テンプレート例

```markdown
## {{type}}: {{title}}

### 状況
{{description}}

### 推奨アクション
{{actionable}}

### データソース
- 期間: {{dataRange}}
- サンプル数: {{sampleSize}}
```

## 評価指標

インサイトの有用性を評価：

- **閲覧率**: ユーザーがインサイトを見た割合
- **アクション率**: インサイトに基づいてアクションを起こした割合
- **フィードバック**: 「役立った」「役立たなかった」のフィードバック

---

詳細な実装は `backend/functions/src/scheduled/insightJob.ts` を参照。
